<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BNI Referral Contact Generator</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    * { box-sizing: border-box; }
    body { margin: 0; padding: 24px; background: #fff; color: #111; }
    h1 { margin: 0 0 8px }
    p.hint { margin: 0 0 16px; color: #555 }
    .meeting-heading { margin: 0 0 16px; font-size: 16px; font-weight: 600; color: #444; }
    textarea { width: 100%; min-height: 160px; padding: 12px; font: inherit; border: 1px solid #ddd; border-radius: 8px; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; margin: 12px 0 20px; }
    button, input[type="text"], input[type="date"] { font: inherit; padding: 10px 12px; }
    button { cursor: pointer; border-radius: 8px; border: 1px solid #ddd; background: #fafafa; }
    button:hover { background: #f2f2f2; }
    #shareUrl { flex: 1 1 360px; min-width: 240px; border: 1px solid #ddd; border-radius: 8px; }
    #instructionsViewer { display: none; }
    body[data-mode="viewer"] #instructionsEditor { display: none; }
    body[data-mode="viewer"] #instructionsViewer { display: block; }
    img.icon { width: 16px; height: 16px; vertical-align: middle; margin-right: 4px; }
    #openAllRow { display: none; }
    #openAllRow button { width: 100%; }
    .table-wrapper { width: 100%; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 6px 8px; text-align: left; border-bottom: 1px solid #ddd; }
    tfoot td { border-bottom: none; padding-top: 12px; }
    td .actions { margin-top: 4px; display: flex; gap: 8px; }
    td .actions img.icon { margin-right: 0; }
    .mobile-row { display: none; }

    .editor-controls { margin: 32px 0; }
    .editor-controls .editor-panel { display: block; }
    .viewer-controls { display: none; align-items: center; gap: 12px; }
    .viewer-controls p { margin: 0; }

    body[data-mode="viewer"] .editor-controls .editor-panel { display: none; }
    body[data-mode="viewer"] .viewer-controls { display: flex; }
    body[data-mode="editor"] .viewer-controls { display: none; }

    .marketing { margin: 32px 0; display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 24px; }

    .marketing-item {
      display: grid;
      grid-template-columns: 132px 1fr;
      gap: 16px;
      align-items: start;
      background: #f9f9f9;
      padding: 16px;
      border-radius: 12px;
      position: relative;
      border: 1px solid #eee;
      transition: box-shadow .18s ease, transform .18s ease;
      overflow: hidden;
    }
    .marketing-item:focus-within,
    .marketing-item:hover { box-shadow: 0 6px 24px rgba(0,0,0,.08); transform: translateY(-1px); }

    .marketing-item a.card-cover { grid-row: 1 / span 2; grid-column: 1; }
    .marketing-item img.main {
      width: 132px;
      height: 132px;
      object-fit: cover;
      border-radius: 8px;
      display: block;
      background: #ddd;
    }

    .marketing-item .content {
      grid-column: 2;
      display: grid;
      gap: 8px;
      padding-right: 140px; /* room for logo */
      min-height: 132px;
    }

    /* clickable text styled like normal text */
    .lead-link {
      color: inherit;
      text-decoration: none;
      line-height: 1.35;
      font-size: 20px;
      font-weight: 600;
      display: block;
    }
    .lead-link .brand { font-weight: 800; }

    .marketing-item .company-logo {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 120px;
      height: 48px;
      display: grid;
      place-items: center;
      border-radius: 999px;
      background: rgba(255,255,255,.9);
      box-shadow: 0 0 0 1px rgba(0,0,0,.04) inset;
      overflow: hidden;
    }
    .marketing-item .company-logo img {
      max-height: 40px;
      max-width: 110px;
      object-fit: contain;
      filter: saturate(.9);
    }

    .footer { margin-top: 24px; color: #666; font-size: 12px; }

    @media (max-width: 480px) {
      body { padding: 16px; }
      .row { flex-direction: column; align-items: stretch; }
      .row > * { width: 100%; }
      #shareUrl { flex: 1 1 auto; min-width: 0; }
      #results thead { display: none; }
      #results .desktop-row { display: none; }
      #results .mobile-row { display: table-row; }
      #openAllRow { display: none !important; }
      td .actions { margin-top: 8px; gap: 16px; }
      td .actions img.icon { width: 24px; height: 24px; }
    }

    @media (max-width: 540px) {
      .marketing-item {
        grid-template-columns: 96px 1fr;
        grid-template-rows: auto auto;
        padding-bottom: 16px;
      }
      .marketing-item a.card-cover {
        grid-row: 1 / span 2;
        grid-column: 1;
      }
      .marketing-item img.main {
        width: 96px;
        height: 96px;
      }
      .marketing-item .content {
        grid-column: 2;
        grid-row: 1;
        padding-right: 0;
        min-height: 0;
      }
      .marketing-item .company-logo {
        position: static;
        grid-column: 2;
        grid-row: 2;
        margin-top: 8px;
        width: 100px;
        height: 44px;
        justify-self: end;
      }
      .marketing-item .company-logo img {
        max-height: 36px;
        max-width: 92px;
      }
      .lead-link { font-size: 18px; }
    }

    @media (prefers-reduced-motion: reduce) {
      .marketing-item { transition: none; }
    }
  </style>
</head>
<body>
  <h1>BNI Referral Contact Generator</h1>
  <p id="instructionsEditor">Use this referral helper during your BNI meeting. Enter each requested contact to generate LinkedIn, Facebook, and Google searches, launch every search at once with the “Open all” buttons, and share the compiled lookup list with the generated URL.</p>
  <p id="instructionsViewer">Review this shared referral list during your BNI meeting. Use the LinkedIn, Facebook, and Google links or the “Open all” buttons to check each contact, and enable editing if you need to tailor the list for your chapter.</p>

  <section id="referralSection" style="display: none;">
    <h2>Referral links</h2>
    <h3 id="meetingHeading" class="meeting-heading" hidden></h3>
    <div class="table-wrapper">
      <table id="results" aria-live="polite">
        <thead>
          <tr>
            <th>Requester</th>
            <th>LinkedIn</th>
            <th>Facebook</th>
            <th>Google</th>
          </tr>
        </thead>
        <tbody id="resultsBody"></tbody>
        <tfoot>
          <tr id="openAllRow">
            <td></td>
            <td>
              <button id="openAllLinkedIn"><img class="icon" src="https://cdn-icons-png.flaticon.com/512/174/174857.png" alt="LinkedIn" />Open all in LinkedIn</button>
            </td>
            <td>
              <button id="openAllFacebook"><img class="icon" src="https://cdn-icons-png.flaticon.com/512/733/733547.png" alt="Facebook" />Open all in Facebook</button>
            </td>
            <td>
              <button id="openAllGoogle"><img class="icon" src="https://www.google.com/favicon.ico" alt="Google" />Open all in Google</button>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="row">
      <button id="copyShare">Copy shareable link</button>
      <input id="shareUrl" type="text" readonly placeholder="Shareable URL will appear here" />
    </div>
    <div class="viewer-controls row">
      <p class="hint">Want to make changes? Enable editing to start your own list.</p>
      <button id="enableEditing" type="button">Enable editing</button>
    </div>
    <p class="hint">Copy the link and share with the rest of the chapter to save you all time and increase referrals.</p>
  </section>

  <section class="editor-controls">
    <div class="editor-panel">
      <h2>How to use</h2>
      <p class="hint">Enter one person per line, optionally starting with the requester's name and a colon (e.g. <em>Alice: Chris Gage, Thrive Homecare</em> or <em>Bob: John Smith, Acme Ltd</em>).</p>

      <div class="row">
        <input id="meetingName" type="text" placeholder="Meeting name" />
        <input id="meetingDate" type="date" />
      </div>

      <textarea id="people" placeholder="Alice: Chris Gage, Thrive Homecare
Bob: Jane Doe, Example Ltd
John Smith Marketing"></textarea>
    </div>
    <div class="row share-tools">
      <button id="openBlank" type="button">Open blank tool</button>
      <button id="copyBlank" type="button">Share this tool</button>
    </div>
  </section>

  <h3>This tool was developed by Thrive to make fellow BNI members' lives that bit better</h3>
  <section class="marketing">
    <div class="marketing-item" tabindex="0">
      <a class="card-cover" href="https://thrivehomecare.co.uk" target="_blank" rel="noopener">
        <img class="main" loading="lazy" src="https://static.wixstatic.com/media/3cbab2_e5798e2104364d30aedf1051ff960d33~mv2.png/v1/fill/w_499,h_896,fp_0.62_0.31,q_90,enc_avif,quality_auto/d22m7f6j9drmc0cmyn6b9js9bg-0.png" alt="Thrive Homecare" />
      </a>
      <div class="content">
        <a href="https://thrivehomecare.co.uk" class="lead-link" target="_blank" rel="noopener">
          Helping your parents thrive in the south east of England, and giving you peace of mind — <span class="brand">Thrive Homecare</span>.
        </a>
      </div>
      <a href="https://thrivehomecare.co.uk" target="_blank" rel="noopener" class="company-logo" aria-label="Visit Thrive Homecare">
        <img loading="lazy" src="https://static.wixstatic.com/media/3cbab2_a584714b048842648b34615dd1dc792a~mv2.png/v1/fill/w_478,h_240,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/thrive-logo-CutOut.png" alt="Thrive Homecare logo" />
      </a>
    </div>

    <div class="marketing-item" tabindex="0">
      <a class="card-cover" href="https://www.planwithcare.co.uk/" target="_blank" rel="noopener">
        <img class="main" loading="lazy" src="https://static.wixstatic.com/media/bb55db_75d182c6523943fa97eebe5534a1eac8~mv2.jpg/v1/fill/w_378,h_638,fp_0.50_0.50,q_80,enc_avif,quality_auto/bb55db_75d182c6523943fa97eebe5534a1eac8~mv2.jpg" alt="Plan with Care" />
      </a>
      <div class="content">
        <a href="https://www.planwithcare.co.uk/" class="lead-link" target="_blank" rel="noopener">
          Health and Welfare expertise and management for solicitors, reducing non-billable time and stress, at no cost to you or your clients — <span class="brand">Plan with Care</span>.
        </a>
      </div>
      <a href="https://www.planwithcare.co.uk/" target="_blank" rel="noopener" class="company-logo" aria-label="Visit Plan with Care">
        <img loading="lazy" src="https://static.wixstatic.com/media/bb55db_45b2cd200703427f91b1721083529c35~mv2.png/v1/fill/w_208,h_158,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Planwithcare%20logo%20ACTUAL.png" alt="Plan with Care logo" />
      </a>
    </div>
  </section>

  <div class="footer">
    Built with referrals in mind by <a href="https://bnikent.co.uk/en-GB/memberdetails?encryptedMemberId=Q88w1PE3FMylGImDTiEfrQ%3D%3D&cmsv3=true&name=Chris+Gage" target="_blank" rel="noopener">Chris Gage</a>, a member of the <a href="https://bnikent.co.uk/en-GB/chapterdetail?chapterId=%2By1kEvGDBwVXevV5lVxbag%3D%3D&name=Online%20Canterbury" target="_blank" rel="noopener">Online Canterbury Chapter</a>, Founder of <a href="https://thrivehomecare.co.uk" target="_blank" rel="noopener">Thrive Homecare</a>,
    and <a href="https://www.planwithcare.co.uk/" target="_blank" rel="noopener">Plan with Care</a>.
  </div>

  <script>
    (function () {
      const $ = (sel) => document.querySelector(sel);
      const bodyEl = document.body;
      const peopleEl = $('#people');
      const meetingNameEl = $('#meetingName');
      const meetingDateEl = $('#meetingDate');
      const meetingHeadingEl = $('#meetingHeading');
      const resultsBodyEl = $('#resultsBody');
      const shareEl = $('#shareUrl');
      const referralSectionEl = $('#referralSection');
      const openAllRowEl = $('#openAllRow');
      const openAllLinkedInEl = $('#openAllLinkedIn');
      const openAllFacebookEl = $('#openAllFacebook');
      const openAllGoogleEl = $('#openAllGoogle');
      const openBlankEl = $('#openBlank');
      const copyBlankEl = $('#copyBlank');
      const emailBlankEl = $('#emailBlank');
      const enableEditingEl = $('#enableEditing');

      bodyEl.dataset.mode = 'editor';

      function searchUrls(q) {
        const label = q.trim();
        const clean = label.replace(/\s+/g, ' ').replace(/\s*,\s*/g, ' ');
        const liUrl = 'https://www.linkedin.com/search/results/all?keywords=' + encodeURIComponent(clean);
        const fbUrl = 'https://www.facebook.com/search/top?q=' + encodeURIComponent(clean);
        const gUrl = 'https://www.google.com/search?q=' + encodeURIComponent(clean);
        return { label, liUrl, fbUrl, gUrl };
      }

      function render(list) {
        resultsBodyEl.innerHTML = '';
        const filtered = list.filter(item => item.query.trim());
        filtered.forEach(({ requestor, query }) => {
          const { label, liUrl, fbUrl, gUrl } = searchUrls(query);

          // desktop row
          const dRow = document.createElement('tr');
          dRow.className = 'desktop-row';

          const dReqTd = document.createElement('td');
          dReqTd.textContent = requestor;
          dRow.appendChild(dReqTd);

          function createCell(url, src, alt) {
            const td = document.createElement('td');
            const a = document.createElement('a');
            a.href = url;
            a.target = '_blank';
            a.rel = 'noopener';
            const img = document.createElement('img');
            img.src = src;
            img.alt = alt;
            img.className = 'icon';
            a.appendChild(img);
            a.appendChild(document.createTextNode(label));
            td.appendChild(a);
            return td;
          }

          dRow.appendChild(createCell(liUrl, 'https://cdn-icons-png.flaticon.com/512/174/174857.png', 'LinkedIn'));
          dRow.appendChild(createCell(fbUrl, 'https://cdn-icons-png.flaticon.com/512/733/733547.png', 'Facebook'));
          dRow.appendChild(createCell(gUrl, 'https://www.google.com/favicon.ico', 'Google'));
          resultsBodyEl.appendChild(dRow);

          // mobile row
          const mRow = document.createElement('tr');
          mRow.className = 'mobile-row';

          const mReqTd = document.createElement('td');
          mReqTd.textContent = requestor;
          mRow.appendChild(mReqTd);

          const mSearchTd = document.createElement('td');
          const nameDiv = document.createElement('div');
          nameDiv.textContent = label;
          mSearchTd.appendChild(nameDiv);

          const actionsDiv = document.createElement('div');
          actionsDiv.className = 'actions';

          function addAction(url, src, alt) {
            const a = document.createElement('a');
            a.href = url;
            a.target = '_blank';
            a.rel = 'noopener';
            const img = document.createElement('img');
            img.src = src;
            img.alt = alt;
            img.className = 'icon';
            a.appendChild(img);
            actionsDiv.appendChild(a);
          }

          addAction(liUrl, 'https://cdn-icons-png.flaticon.com/512/174/174857.png', 'LinkedIn');
          addAction(fbUrl, 'https://cdn-icons-png.flaticon.com/512/733/733547.png', 'Facebook');
          addAction(gUrl, 'https://www.google.com/favicon.ico', 'Google');

          mSearchTd.appendChild(actionsDiv);
          mRow.appendChild(mSearchTd);

        resultsBodyEl.appendChild(mRow);
        });
        referralSectionEl.style.display = filtered.length ? 'block' : 'none';
        openAllRowEl.style.display = filtered.length >= 2 ? 'table-row' : 'none';
      }

      function getLines() {
        return peopleEl.value.split(/\r?\n/).map(line => {
          const [requestorPart, queryPart] = line.split(':', 2);
          if (queryPart === undefined) {
            return { requestor: '', query: requestorPart.trim() };
          }
          return { requestor: requestorPart.trim(), query: queryPart.trim() };
        });
      }

      function setShareUrl() {
        const raw = peopleEl.value.trim();
        const meetingName = meetingNameEl.value.trim();
        const meetingDate = meetingDateEl.value;
        const url = new URL(window.location.href);
        if (raw) {
          url.searchParams.set('list', raw.replace(/\r?\n/g, '\n'));
        } else {
          url.searchParams.delete('list');
        }
        if (meetingName) {
          url.searchParams.set('meeting', meetingName);
        } else {
          url.searchParams.delete('meeting');
        }
        if (meetingDate) {
          url.searchParams.set('date', meetingDate);
        } else {
          url.searchParams.delete('date');
        }
        url.searchParams.delete('edit');
        shareEl.value = url.toString();
        window.history.replaceState(null, '', url);
        updateMeetingHeading();
      }

      function formatMeetingDate(value) {
        if (!value) {
          return '';
        }
        const [year, month, day] = value.split('-').map(Number);
        if (
          Number.isNaN(year) ||
          Number.isNaN(month) ||
          Number.isNaN(day)
        ) {
          return value;
        }
        const date = new Date(Date.UTC(year, month - 1, day));
        return date.toLocaleDateString(undefined, {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          timeZone: 'UTC',
        });
      }

      function updateMeetingHeading() {
        if (!meetingHeadingEl) {
          return;
        }
        const meetingName = meetingNameEl.value.trim();
        const meetingDate = meetingDateEl.value;
        const parts = [];
        if (meetingName) {
          parts.push(meetingName);
        }
        const formattedDate = formatMeetingDate(meetingDate);
        if (formattedDate) {
          parts.push(formattedDate);
        }
        if (parts.length) {
          meetingHeadingEl.textContent = parts.join(' — ');
          meetingHeadingEl.hidden = false;
        } else {
          meetingHeadingEl.textContent = '';
          meetingHeadingEl.hidden = true;
        }
      }

      function loadFromUrl() {
        const url = new URL(window.location.href);
        const listParam = url.searchParams.get('list');
        if (listParam) {
          peopleEl.value = listParam;
          render(getLines());
        }
        const meetingParam = url.searchParams.get('meeting');
        if (meetingParam) {
          meetingNameEl.value = meetingParam;
        }
        const dateParam = url.searchParams.get('date');
        if (dateParam) {
          meetingDateEl.value = dateParam;
        }
        const isViewer = !!listParam && !url.searchParams.has('edit');
        bodyEl.dataset.mode = isViewer ? 'viewer' : 'editor';
        peopleEl.readOnly = isViewer;
        meetingNameEl.readOnly = isViewer;
        meetingDateEl.disabled = isViewer;
        setShareUrl();
      }

      openAllLinkedInEl.addEventListener('click', () => {
        const list = getLines();
        list.forEach(({ query }) => {
          if (query.trim()) {
            const { liUrl } = searchUrls(query);
            window.open(liUrl, '_blank');
          }
        });
      });

      openAllFacebookEl.addEventListener('click', () => {
        const list = getLines();
        list.forEach(({ query }) => {
          if (query.trim()) {
            const { fbUrl } = searchUrls(query);
            window.open(fbUrl, '_blank');
          }
        });
      });

      openAllGoogleEl.addEventListener('click', () => {
        const list = getLines();
        list.forEach(({ query }) => {
          if (query.trim()) {
            const { gUrl } = searchUrls(query);
            window.open(gUrl, '_blank');
          }
        });
      });

      $('#copyShare').addEventListener('click', async () => {
        setShareUrl();
        try {
          await navigator.clipboard.writeText(shareEl.value);
        } catch (_) {
          shareEl.select();
          document.execCommand('copy');
        }
      });

      if (openBlankEl) {
        openBlankEl.addEventListener('click', () => {
          const baseUrl = window.location.origin + window.location.pathname;
          window.open(baseUrl, '_blank');
        });
      }

      if (copyBlankEl) {
        copyBlankEl.addEventListener('click', async () => {
          const baseUrl = window.location.origin + window.location.pathname;
          if (navigator.share) {
            try {
              await navigator.share({
                title: 'BNI Referral Contact Generator',
                url: baseUrl,
              });
              return;
            } catch (err) {
              if (err && err.name === 'AbortError') {
                return;
              }
            }
          }
          try {
            await navigator.clipboard.writeText(baseUrl);
          } catch (_) {
            const temp = document.createElement('input');
            temp.value = baseUrl;
            document.body.appendChild(temp);
            temp.select();
            document.execCommand('copy');
            document.body.removeChild(temp);
          }
        });
      }

      if (enableEditingEl) {
        enableEditingEl.addEventListener('click', () => {
          const url = new URL(window.location.href);
          url.searchParams.set('edit', '1');
          window.location.href = url.toString();
        });
      }

      if (emailBlankEl) {
        emailBlankEl.addEventListener('click', () => {
          const baseUrl = window.location.origin + window.location.pathname;
          window.open(`mailto:?subject=BNI%20Referral%20Contact%20Generator&body=${encodeURIComponent(baseUrl)}`);
        });
      }

      let t;
      peopleEl.addEventListener('input', () => {
        clearTimeout(t);
        t = setTimeout(() => {
          render(getLines());
          setShareUrl();
        }, 250);
      });

      meetingNameEl.addEventListener('input', setShareUrl);
      meetingDateEl.addEventListener('input', setShareUrl);

      loadFromUrl();
      render(getLines());
    })();
  </script>
</body>
</html>
